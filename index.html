<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Raketen-Spiel</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    canvas { display: block; margin: auto; background: #000; }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let keys = {};
let bullets = [];
let asteroids = [];
let ufos = [];
let ufoBullets = [];

const player = {
  x: canvas.width/2,
  y: canvas.height/2,
  w: 40,
  h: 40,
  speed: 5,
  color: "lime"
};

document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function shoot() {
  bullets.push({
    x: player.x + player.w/2 - 2,
    y: player.y,
    w: 4,
    h: 10,
    speed: 8
  });
}

document.addEventListener("keydown", e => {
  if (e.code === "Space") shoot();
});

function spawnAsteroid() {
  asteroids.push({
    x: Math.random() * canvas.width,
    y: -50,
    r: 30 + Math.random() * 20,
    speed: 2 + Math.random()*2
  });
}

function spawnUFO() {
  ufos.push({
    x: Math.random() * (canvas.width-60),
    y: -60,
    w: 60,
    h: 30,
    speed: 2,
    cooldown: 0
  });
}

function update() {
  // Player movement
  if (keys["w"] || keys["W"]) player.y -= player.speed;
  if (keys["s"] || keys["S"]) player.y += player.speed;
  if (keys["a"] || keys["A"]) player.x -= player.speed;
  if (keys["d"] || keys["D"]) player.x += player.speed;

  // Keep player in bounds
  player.x = Math.max(0, Math.min(canvas.width-player.w, player.x));
  player.y = Math.max(0, Math.min(canvas.height-player.h, player.y));

  // Update bullets
  bullets = bullets.filter(b => b.y > -b.h);
  bullets.forEach(b => b.y -= b.speed);

  // Update asteroids
  asteroids.forEach(a => a.y += a.speed);
  asteroids = asteroids.filter(a => a.y < canvas.height + a.r);

  // Update UFOs
  ufos.forEach(ufo => {
    ufo.y += ufo.speed;

    if (ufo.cooldown <= 0) {
      // Shoot at player
      const dx = (player.x+player.w/2) - (ufo.x+ufo.w/2);
      const dy = (player.y+player.h/2) - (ufo.y+ufo.h/2);
      const len = Math.sqrt(dx*dx + dy*dy);
      ufoBullets.push({
        x: ufo.x+ufo.w/2,
        y: ufo.y+ufo.h/2,
        dx: dx/len*4,
        dy: dy/len*4,
        r: 5
      });
      ufo.cooldown = 120; // ca. alle 2 sek
    } else {
      ufo.cooldown--;
    }
  });
  ufos = ufos.filter(u => u.y < canvas.height+60);

  // Update UFO bullets
  ufoBullets.forEach(b => {
    b.x += b.dx;
    b.y += b.dy;
  });
  ufoBullets = ufoBullets.filter(b => b.x>-10 && b.x<canvas.width+10 && b.y>-10 && b.y<canvas.height+10);

  // Collision bullets vs asteroids
  bullets.forEach((b, bi) => {
    asteroids.forEach((a, ai) => {
      const dx = b.x - a.x;
      const dy = b.y - a.y;
      if (Math.sqrt(dx*dx+dy*dy) < a.r) {
        asteroids.splice(ai,1);
        bullets.splice(bi,1);
      }
    });
  });

  // Collision bullets vs UFO
  bullets.forEach((b, bi) => {
    ufos.forEach((u, ui) => {
      if (b.x < u.x+u.w && b.x+b.w > u.x && b.y < u.y+u.h && b.y+b.h > u.y) {
        ufos.splice(ui,1);
        bullets.splice(bi,1);
      }
    });
  });
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Draw player
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // Draw bullets
  ctx.fillStyle = "yellow";
  bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

  // Draw asteroids
  ctx.fillStyle = "gray";
  asteroids.forEach(a => {
    ctx.beginPath();
    ctx.arc(a.x, a.y, a.r, 0, Math.PI*2);
    ctx.fill();
  });

  // Draw UFO
  ctx.fillStyle = "red";
  ufos.forEach(u => ctx.fillRect(u.x, u.y, u.w, u.h));

  // Draw UFO bullets
  ctx.fillStyle = "orange";
  ufoBullets.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
    ctx.fill();
  });
}

setInterval(spawnAsteroid, 1500);
setInterval(() => {
  if (Math.random() < 0.3) spawnUFO();
}, 8000);

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
